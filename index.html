<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Calculadora DV RUT — Chile</title>
<style>
  :root{
    --blue:#0039A6;
    --red:#D52B1E;
    --white:#ffffff;
    --ink:#0f172a;
    --muted:#6b7280;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color:var(--ink);
    background:
      radial-gradient(1200px 600px at 0% 0%, rgba(0,57,166,.15), transparent 60%),
      radial-gradient(900px 500px at 100% 100%, rgba(213,43,30,.12), transparent 60%),
      linear-gradient(180deg,#f8fafc, #fff);
    min-height:100dvh;
    display:grid; place-items:center; padding:24px;
  }
  .flag-band{
    position:fixed; inset:0 0 auto 0; height:14px; background:var(--blue);
  }
  .flag-band.bottom{ top:auto; bottom:0; background:var(--red); }
  .card{
    width:min(720px, 95vw);
    background:rgba(255,255,255,.9);
    border:1px solid rgba(15,23,42,.06);
    border-radius:20px;
    box-shadow:0 20px 50px rgba(0,0,0,.1);
    overflow:hidden;
  }
  .hero{
    position:relative; padding:28px 28px 18px;
    background:
      linear-gradient(135deg, rgba(0,57,166,.95), rgba(0,57,166,.85) 50%, rgba(213,43,30,.85));
    color:white;
  }
  .hero h1{ margin:0 0 6px; font-size:clamp(22px, 2.6vw, 30px); letter-spacing:.3px }
  .hero p{ margin:0; opacity:.9 }
  .starbox{
    position:absolute; left:22px; top:22px; width:56px; height:56px;
    background:var(--blue); border-radius:12px; border:1px solid rgba(255,255,255,.25);
    display:grid; place-items:center; box-shadow:inset 0 0 0 2px rgba(255,255,255,.1);
  }
  .header-text{ padding-left:88px }
  .content{ padding:22px 24px 26px; display:grid; gap:18px }
  .row{ display:grid; grid-template-columns:1fr auto; gap:12px; align-items:end }
  label{ display:block; font-weight:600; margin:0 0 8px }
  .input{
    border:1.8px solid rgba(15,23,42,.1);
    border-radius:14px; padding:14px 14px; font-size:18px; width:100%;
    outline:none; transition:.2s border, .2s box-shadow; background:#fff;
  }
  .input:focus{ border-color:var(--blue); box-shadow:0 0 0 4px rgba(0,57,166,.12) }
  .btn{
    cursor:pointer; border:0; border-radius:12px; padding:12px 16px; font-weight:700;
    background:linear-gradient(135deg,var(--red),#ff5a4f); color:white; box-shadow:0 8px 16px rgba(213,43,30,.25);
    transition:.2s transform,.2s filter;
  }
  .btn:hover{ transform:translateY(-1px); filter:brightness(1.03) }
  .grid{
    display:grid; gap:14px; grid-template-columns: 1fr 1fr;
  }
  .tile{
    background:#fff; border:1px solid rgba(15,23,42,.06); border-radius:14px; padding:14px 16px;
  }
  .kpi{ font-size:clamp(22px,3.2vw,28px); font-weight:800; color:var(--blue) }
  .muted{ color:var(--muted); font-size:14px }
  .ok{ color:#059669; font-weight:700 }
  .warn{ color:#b91c1c; font-weight:700 }
  details{
    border:1px dashed rgba(15,23,42,.15); border-radius:12px; padding:10px 12px; background:#fff;
  }
  details>summary{ cursor:pointer; font-weight:700 }
  table{ width:100%; border-collapse:collapse; margin-top:10px; font-size:14px }
  th,td{ padding:8px 10px; border-bottom:1px solid rgba(15,23,42,.06); text-align:center }
  th{ background:rgba(0,57,166,.06) }
  .copy{
    background:#0ea5e9; color:white; border:0; padding:10px 12px; border-radius:10px; cursor:pointer; font-weight:700
  }
  @media (max-width:660px){
    .grid{ grid-template-columns:1fr }
    .row{ grid-template-columns:1fr }
    .header-text{ padding-left:84px }
  }
</style>
</head>
<body>
  <div class="flag-band"></div>
  <div class="card" role="application" aria-label="Calculadora dígito verificador RUT">
    <div class="hero">
      <div class="starbox" aria-hidden="true">
        <!-- Estrella blanca -->
        <svg width="34" height="34" viewBox="0 0 24 24" fill="none">
          <path d="M12 2l2.35 5.94 6.41.45-4.93 4.08 1.56 6.22L12 15.9 6.61 18.7l1.56-6.22L3.24 8.39l6.41-.45L12 2z" fill="#fff"/>
        </svg>
      </div>
      <div class="header-text">
        <h1>Calculadora de Dígito Verificador — RUT</h1>
        <p>Escribe el <strong>cuerpo</strong> del RUT y obtén el DV (módulo 11) al instante.</p>
      </div>
    </div>

    <div class="content">
      <div class="row">
        <div>
          <label for="cuerpo">Cuerpo del RUT (solo dígitos, 7–9 recomendado)</label>
          <input id="cuerpo" class="input" inputmode="numeric" autocomplete="off" placeholder="Ej: 12345678" maxlength="9">
        </div>
        <button class="btn" id="btnLimpiar" title="Limpiar">Limpiar</button>
      </div>

      <div class="grid">
        <div class="tile">
          <div class="muted">Dígito verificador</div>
          <div class="kpi" id="dv">—</div>
          <div id="estado" class="muted">Ingresa el cuerpo para calcular.</div>
        </div>
        <div class="tile">
          <div class="muted">RUT formateado</div>
          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <div class="kpi" id="rutFmt">—</div>
            <button class="copy" id="btnCopiar" disabled>Copiar</button>
          </div>
          <div class="muted">Formato: 12.345.678-5</div>
        </div>
      </div>

      <details id="pasos" open>
        <summary>Ver paso a paso del cálculo (módulo 11)</summary>
        <div id="tablaWrap"></div>
      </details>
    </div>
  </div>
  <div class="flag-band bottom"></div>

<script>
/* ====== Utilidades RUT (módulo 11) ====== */
function calcularDV(cuerpoStr){
  const cuerpo = String(cuerpoStr).replace(/\D/g,'');
  if (!cuerpo) return null;
  let suma = 0, mult = 2;
  for (let i = cuerpo.length - 1; i >= 0; i--) {
    suma += Number(cuerpo[i]) * mult;
    mult = mult === 7 ? 2 : mult + 1;
  }
  const resto = 11 - (suma % 11);
  return resto === 11 ? '0' : (resto === 10 ? 'K' : String(resto));
}

function formatearCuerpo(cuerpo){
  let s = String(cuerpo).replace(/\D/g,'');
  if (!s) return '';
  let out = '';
  while (s.length > 3){
    out = '.' + s.slice(-3) + out;
    s = s.slice(0, -3);
  }
  return s + out;
}

/* ====== UI ====== */
const $cuerpo = document.getElementById('cuerpo');
const $dv = document.getElementById('dv');
const $rutFmt = document.getElementById('rutFmt');
const $estado = document.getElementById('estado');
const $tablaWrap = document.getElementById('tablaWrap');
const $btnCopiar = document.getElementById('btnCopiar');
const $btnLimpiar = document.getElementById('btnLimpiar');

$cuerpo.addEventListener('input', ()=>{
  // Sanitiza y limita a 9 dígitos
  const limpio = $cuerpo.value.replace(/\D/g,'').slice(0,9);
  if ($cuerpo.value !== limpio) $cuerpo.value = limpio;

  if (!limpio) {
    $dv.textContent = '—';
    $rutFmt.textContent = '—';
    $estado.textContent = 'Ingresa el cuerpo para calcular.';
    $estado.className = 'muted';
    $tablaWrap.innerHTML = '';
    $btnCopiar.disabled = true;
    return;
  }
  const dv = calcularDV(limpio);
  $dv.textContent = dv ?? '—';
  const fmt = `${formatearCuerpo(limpio)}-${dv ?? ''}`;
  $rutFmt.textContent = dv ? fmt : '—';
  $btnCopiar.disabled = !dv;

  // Estado y validación suave (longitud sugerida)
  if (limpio.length < 7){
    $estado.textContent = 'Cuerpo corto. Recomendado 7–9 dígitos para RUT reales.';
    $estado.className = 'warn';
  } else {
    $estado.textContent = 'Cálculo correcto (módulo 11).';
    $estado.className = 'ok';
  }

  // Render paso a paso
  renderTabla(limpio);
});

$btnCopiar.addEventListener('click', async ()=>{
  const texto = $rutFmt.textContent;
  try{
    await navigator.clipboard.writeText(texto);
    $btnCopiar.textContent = '¡Copiado!';
    setTimeout(()=> $btnCopiar.textContent = 'Copiar', 1200);
  }catch{
    alert('No se pudo copiar automáticamente. Selecciona y copia manualmente.');
  }
});

$btnLimpiar.addEventListener('click', ()=>{
  $cuerpo.value = '';
  $cuerpo.dispatchEvent(new Event('input'));
  $cuerpo.focus();
});

function renderTabla(cuerpo){
  // Calcula pesos y productos
  const digits = String(cuerpo).split('').map(n=>Number(n));
  const pesos = [];
  for (let i=digits.length-1, m=2; i>=0; i--){
    pesos[i] = m;
    m = m === 7 ? 2 : m + 1;
  }
  const productos = digits.map((d,i)=> d * pesos[i]);
  const suma = productos.reduce((a,b)=>a+b,0);
  const mod = suma % 11;
  const resto = 11 - mod;
  const dv = resto === 11 ? '0' : (resto === 10 ? 'K' : String(resto));

  const rows = digits.map((d,i)=>`
    <tr>
      <td>${i+1}</td>
      <td>${d}</td>
      <td>${pesos[i]}</td>
      <td>${d} × ${pesos[i]}</td>
      <td>${productos[i]}</td>
    </tr>`).join('');

  $tablaWrap.innerHTML = `
    <table aria-label="Tabla paso a paso">
      <thead>
        <tr><th>#</th><th>Dígito</th><th>Peso</th><th>Producto</th><th>Parcial</th></tr>
      </thead>
      <tbody>${rows}</tbody>
      <tfoot>
        <tr><td colspan="4" style="text-align:right;font-weight:700">Suma</td><td><strong>${suma}</strong></td></tr>
        <tr><td colspan="4" style="text-align:right">Suma % 11</td><td>${mod}</td></tr>
        <tr><td colspan="4" style="text-align:right">Resto (11 - %)</td><td>${resto}</td></tr>
        <tr><td colspan="4" style="text-align:right;font-weight:800">DV</td><td><strong>${dv}</strong></td></tr>
      </tfoot>
    </table>`;
}

// Estado inicial
$cuerpo.dispatchEvent(new Event('input'));
</script>
</body>
</html>
